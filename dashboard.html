<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="description" content="Revenue Dashboard - Il Ngwesi Conservancy">
    <meta name="theme-color" content="#d4a574">
    <title>Revenue Dashboard - Il Ngwesi Conservancy</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* Modern, fluid, inspiring dashboard design */
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
        }

        .navbar {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%) !important;
            backdrop-filter: blur(20px) !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3) !important;
        }

        .nav-brand h1 {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .dashboard {
            padding: 1.5rem;
            background: transparent;
            min-height: 100vh;
        }

        .dashboard-header {
            background: transparent;
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            margin-left: 0;
            padding-left: 0;
            border-bottom: 2px solid rgba(212, 165, 116, 0.2);
        }

        .dashboard-header h1 {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 0.5rem 0;
            padding-left: 0;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .dashboard-header p {
            color: #64748b;
            font-size: 1rem;
            margin: 0;
            padding-left: 0;
            font-weight: 400;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid rgba(212, 165, 116, 0.15);
        }

        .stat-box {
            background: transparent;
            padding: 0;
            transition: all 0.3s ease;
            position: relative;
        }

        .stat-box:hover {
            transform: translateX(4px);
        }

        .stat-box-label {
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .stat-box-value-wrapper {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .stat-box-value {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .stat-box-change {
            font-size: 0.7rem;
            color: #10b981;
            font-weight: 500;
        }

        .revenue-breakdown {
            background: transparent;
            padding: 0;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid rgba(212, 165, 116, 0.15);
        }

        .revenue-breakdown h2 {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 1rem 0;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        .chart-container {
            background: transparent;
            padding: 0;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid rgba(212, 165, 116, 0.15);
        }

        .chart-container:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .chart-container h2 {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 1.5rem 0;
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .chart-container canvas {
            max-height: 300px;
        }


        .revenue-row.hidden {
            display: none;
        }

        .revenue-filters {
            margin-bottom: 1.5rem;
        }

        .revenue-filters-label {
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .revenue-list {
            display: flex;
            flex-direction: column;
            gap: 0;
            width: 100%;
            max-width: 100%;
        }

        .revenue-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(212, 165, 116, 0.1);
            gap: 1rem;
        }

        .revenue-item:last-child {
            border-bottom: none;
        }

        .revenue-item-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
            min-width: 0;
        }

        .revenue-item-name {
            font-weight: 500;
            color: #1e293b;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .revenue-item-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-shrink: 0;
        }

        .revenue-item-amount {
            font-weight: 600;
            color: #2c5530;
            font-size: 0.9rem;
            text-align: right;
            white-space: nowrap;
            min-width: 90px;
        }

        .revenue-item-percentage {
            color: #64748b;
            font-size: 0.85rem;
            text-align: right;
            white-space: nowrap;
            min-width: 50px;
        }

        .category-badge {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 0.75rem;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .category-badge.accommodation {
            background: #d4a574;
        }

        .category-badge.marketplace {
            background: #2c5530;
        }

        .category-badge.tourism {
            background: #8b4513;
        }

        .category-badge.cultural {
            background: #b8935f;
        }

        .category-badge.miscellaneous {
            background: #6b7280;
        }

        .percentage-badge {
            font-weight: 600;
            color: #64748b;
            font-size: 0.9rem;
            letter-spacing: 0.01em;
        }


        .filter-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            border-radius: 0;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            color: #64748b;
            transition: all 0.3s ease;
            position: relative;
            border-bottom: 2px solid transparent;
        }

        .filter-btn:hover {
            color: #2c5530;
        }

        .filter-btn.active {
            color: #2c5530;
            border-bottom-color: #d4a574;
            font-weight: 600;
        }

        .time-period-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .category-filters-section {
            background: transparent;
            padding: 0;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(212, 165, 116, 0.15);
        }

        .category-filters-section h2 {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 1.25rem 0;
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .category-filters-label {
            font-weight: 600;
            color: #666;
            margin-bottom: 0.75rem;
            font-size: 0.85rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .time-period-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            border-radius: 0;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            color: #64748b;
            transition: all 0.3s ease;
            position: relative;
            border-bottom: 2px solid transparent;
        }

        .time-period-btn:hover {
            color: #2c5530;
        }

        .time-period-btn.active {
            color: #2c5530;
            border-bottom-color: #d4a574;
            font-weight: 600;
        }


        @media (min-width: 768px) {
            .dashboard {
                padding: 2.5rem;
            }

            .dashboard-header {
                padding: 2.5rem 0;
                padding-left: 0;
            }

            .dashboard-header h1 {
                font-size: 2.5rem;
            }

            .dashboard-stats {
                grid-template-columns: repeat(4, 1fr);
                gap: 1.5rem;
            }

            .stat-box {
                padding: 2rem;
            }

            .stat-box-value {
                font-size: 1.5rem;
            }


            .chart-container {
                padding: 2.5rem;
            }

            .chart-container canvas {
                max-height: 400px;
            }

            .revenue-breakdown {
                padding: 2.5rem;
            }
        }

        @media (min-width: 1024px) {

            .dashboard {
                padding: 3rem;
            }
        }

        /* Product Sales Responsive Styles */
        @media (max-width: 768px) {
            #productSalesTable .sales-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)) !important;
                gap: 1rem !important;
            }

            #productSalesTable .sales-card {
                margin-bottom: 0;
            }

            #productSalesTable .sales-card > div:first-child {
                padding-top: 60% !important;
            }

            #productSalesTable .sales-card h3 {
                font-size: 1rem !important;
            }

            #productSalesTable .sales-table {
                font-size: 0.875rem;
            }

            #productSalesTable .sales-table th,
            #productSalesTable .sales-table td {
                padding: 0.75rem 0.5rem !important;
            }

            #productSalesTable .sales-table img {
                width: 40px !important;
                height: 40px !important;
            }

            #productSalesTable .sales-table .order-summary-item-name {
                font-size: 0.875rem !important;
            }

            .sales-view-btn {
                font-size: 0.875rem !important;
                padding: 0.375rem 0.75rem !important;
            }

            .chart-container > div:first-child {
                flex-direction: column !important;
                align-items: flex-start !important;
            }
        }

        @media (max-width: 480px) {
            #productSalesTable .sales-grid {
                grid-template-columns: 1fr !important;
            }

            #productSalesTable .sales-card {
                padding: 1rem !important;
            }

            #productSalesTable .sales-card > div:first-child {
                padding-top: 75% !important;
            }

            #productSalesTable .sales-card h3 {
                font-size: 0.95rem !important;
            }

            #productSalesTable .sales-card .sales-stats {
                font-size: 0.875rem !important;
            }

            #productSalesTable .sales-card .sales-stats span:last-child {
                font-size: 1.25rem !important;
            }

            #productSalesTable .sales-table {
                font-size: 0.75rem;
                min-width: 500px;
            }

            #productSalesTable .sales-table th,
            #productSalesTable .sales-table td {
                padding: 0.5rem 0.25rem !important;
            }

            #productSalesTable .sales-table img {
                width: 35px !important;
                height: 35px !important;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1>Il Ngwesi</h1>
                <span class="tagline">Revenue Dashboard</span>
            </div>
            <ul class="nav-menu">
                <li><a href="community.html">Community Portal</a></li>
                <li><a href="index.html">Back to Website</a></li>
                <li><a href="#" id="logoutBtn" style="color: #dc2626;">Logout</a></li>
            </ul>
        </div>
    </nav>

    <!-- Dashboard -->
    <section class="dashboard" style="margin-top: 80px;">
        <div class="container">
            <div class="dashboard-header">
                <h1>Revenue Dashboard</h1>
                <p>Revenue tracking and performance metrics</p>
            </div>

            <!-- Time Period Selector -->
            <div class="time-period-selector">
                <button class="time-period-btn active" data-period="month">Month</button>
                <button class="time-period-btn" data-period="quarter">Quarter</button>
                <button class="time-period-btn" data-period="year">Year</button>
                <button class="time-period-btn" data-period="all">All Time</button>
            </div>

            <!-- Summary Stats -->
            <div class="dashboard-stats">
                <div class="stat-box">
                    <div class="stat-box-label">Total Revenue</div>
                    <div class="stat-box-value-wrapper">
                        <div class="stat-box-value">KES 2,450,000</div>
                        <div class="stat-box-change">↑ 12%</div>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-label">Total Bookings</div>
                    <div class="stat-box-value-wrapper">
                        <div class="stat-box-value">127</div>
                        <div class="stat-box-change">↑ 8%</div>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-label">Products Sold</div>
                    <div class="stat-box-value-wrapper">
                        <div class="stat-box-value">342</div>
                        <div class="stat-box-change">↑ 15%</div>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-label">Avg. Revenue/Booking</div>
                    <div class="stat-box-value-wrapper">
                        <div class="stat-box-value">KES 19,291</div>
                        <div class="stat-box-change">↑ 4%</div>
                    </div>
                </div>
            </div>

            <!-- Revenue by Category Bar Chart -->
            <div class="chart-container">
                <h2>Revenue by Category</h2>
                <canvas id="categoryBarChart"></canvas>
            </div>

            <!-- Product Performance Chart -->
            <div class="chart-container">
                <h2>Top Products Performance</h2>
                <canvas id="productPerformanceChart"></canvas>
            </div>

            <!-- Product Sales Section -->
            <div class="chart-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                    <h2 style="margin: 0;">Product Sales</h2>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;">
                        <div style="display: flex; gap: 0.5rem; border: 2px solid rgba(212, 165, 116, 0.2); border-radius: 8px; padding: 0.25rem; background: white;">
                            <button class="sales-view-btn active" data-view="grid" style="padding: 0.5rem 1rem; border: none; background: rgba(212, 165, 116, 0.1); border-radius: 6px; cursor: pointer; font-weight: 600; color: var(--secondary-color); transition: all 0.3s ease;">Grid</button>
                            <button class="sales-view-btn" data-view="list" style="padding: 0.5rem 1rem; border: none; background: transparent; border-radius: 6px; cursor: pointer; font-weight: 600; color: var(--text-light); transition: all 0.3s ease;">List</button>
                        </div>
                    </div>
                </div>
                <div id="productSalesTable" style="margin-top: 1.5rem;">
                    <!-- Product sales will be populated by JavaScript -->
                </div>
            </div>

            <!-- Revenue Trends Chart -->
            <div class="chart-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                    <h2 style="margin: 0;">Revenue Trends Over Time</h2>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <div style="background: linear-gradient(135deg, #fef3e7 0%, #fde68a 100%); padding: 0.75rem 1.25rem; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                            <div style="font-size: 0.75rem; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.25rem;">Peak Month</div>
                            <div style="font-size: 1.1rem; font-weight: 700; color: var(--secondary-color);">Nov: KES 330K</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 0.75rem 1.25rem; border-radius: 8px; border-left: 4px solid #10b981;">
                            <div style="font-size: 0.75rem; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.25rem;">Growth</div>
                            <div style="font-size: 1.1rem; font-weight: 700; color: #10b981;">↑ 36.1%</div>
                        </div>
                    </div>
                </div>
                <canvas id="revenueTrendChart"></canvas>
            </div>

        </div>
    </section>

    <script>
        // Authentication check - allow access from community portal
        (function() {
            // Check if logged in via community portal or old authentication
            const communityLoggedIn = sessionStorage.getItem('communityLoggedIn') === 'true';
            const oldAuth = localStorage.getItem('communityAuthenticated') === 'true';
            
            // If neither authentication method is present, redirect to community portal
            if (!communityLoggedIn && !oldAuth) {
                console.log('Not authenticated, redirecting to community portal...');
                window.location.replace('community.html');
                return;
            }
            
            console.log('Authentication successful, dashboard loaded');
        })();

        // Wait for DOM to be fully loaded before initializing charts
        document.addEventListener('DOMContentLoaded', function() {
        // Chart.js configuration - Simple and clean
        Chart.defaults.font.family = 'Inter, sans-serif';
        Chart.defaults.font.size = 12;
        Chart.defaults.color = '#333';

            // Revenue data
            const revenueTrendCtx = document.getElementById('revenueTrendChart').getContext('2d');
            const revenueData = {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [{
                label: 'Revenue (KES)',
                data: [180000, 195000, 210000, 225000, 240000, 255000, 270000, 285000, 300000, 315000, 330000, 245000],
                borderColor: '#d4a574',
                backgroundColor: 'rgba(212, 165, 116, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.4,
                pointRadius: 3,
                pointHoverRadius: 5
            }]
        };

            // Revenue Trends Line Chart
            const revenueTrendChart = new Chart(revenueTrendCtx, {
            type: 'line',
            data: revenueData,
            options: {
                responsive: true,
                maintainAspectRatio: true,
                aspectRatio: 2,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 8,
                        titleFont: { size: 12 },
                        bodyFont: { size: 11 },
                        callbacks: {
                            label: function(context) {
                                return 'KES ' + context.parsed.y.toLocaleString();
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'KES ' + (value / 1000) + 'K';
                            },
                            font: { size: 11 },
                            color: '#666',
                            padding: 8
                        },
                        grid: {
                            color: '#e5e5e5',
                            drawBorder: false
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            font: { size: 11 },
                            color: '#666',
                            padding: 8
                        }
                    }
                }
            }
        });

            // Category Bar Chart
            const categoryBarCtx = document.getElementById('categoryBarChart').getContext('2d');
            const categoryBarChart = new Chart(categoryBarCtx, {
            type: 'bar',
            data: {
                labels: ['Accommodation', 'Marketplace', 'Tourism', 'Cultural'],
                datasets: [{
                    label: 'Revenue (KES)',
                    data: [1543500, 441000, 367500, 98000],
                    backgroundColor: [
                        'rgba(212, 165, 116, 0.8)',
                        'rgba(44, 85, 48, 0.8)',
                        'rgba(139, 69, 19, 0.8)',
                        'rgba(184, 147, 95, 0.8)'
                    ],
                    borderColor: [
                        '#d4a574',
                        '#2c5530',
                        '#8b4513',
                        '#b8935f'
                    ],
                    borderWidth: 2,
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 8,
                        titleFont: { size: 12 },
                        bodyFont: { size: 11 },
                        callbacks: {
                            label: function(context) {
                                const value = context.parsed.y;
                                if (value >= 1000000) {
                                    return 'KES ' + (value / 1000000).toFixed(1) + 'M';
                                } else if (value >= 1000) {
                                    return 'KES ' + (value / 1000).toFixed(0) + 'K';
                                } else {
                                    return 'KES ' + value.toLocaleString();
                                }
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            font: { size: 11 },
                            color: '#666',
                            padding: 8,
                            callback: function(value) {
                                if (value >= 1000000) {
                                    return 'KES ' + (value / 1000000).toFixed(1) + 'M';
                                } else if (value >= 1000) {
                                    return 'KES ' + (value / 1000).toFixed(0) + 'K';
                                } else {
                                    return 'KES ' + value.toLocaleString();
                                }
                            }
                        },
                        grid: {
                            color: '#e5e5e5',
                            drawBorder: false
                        }
                    },
                    x: {
                        ticks: {
                            font: { size: 11 },
                            color: '#666',
                            padding: 8
                        },
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

            // Product Performance Chart
            const productPerformanceCtx = document.getElementById('productPerformanceChart').getContext('2d');
            const productPerformanceChart = new Chart(productPerformanceCtx, {
            type: 'bar',
            data: {
                labels: ['Ecolodge', 'Homestays', 'Beading', 'Wildlife Walks', 'Bags', 'Cultural Evenings'],
                datasets: [{
                    label: 'Revenue (KES)',
                    data: [1102500, 441000, 294000, 196000, 147000, 98000],
                    backgroundColor: function(context) {
                        const value = context.parsed.y;
                        if (value > 800000) return 'rgba(212, 165, 116, 0.9)';
                        if (value > 400000) return 'rgba(212, 165, 116, 0.7)';
                        return 'rgba(212, 165, 116, 0.5)';
                    },
                    borderColor: '#d4a574',
                    borderWidth: 2,
                    borderRadius: 6
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 8,
                        titleFont: { size: 12 },
                        bodyFont: { size: 11 },
                        callbacks: {
                            label: function(context) {
                                const percentage = ((context.parsed.x / 2450000) * 100).toFixed(1);
                                return 'KES ' + context.parsed.x.toLocaleString() + ' (' + percentage + '%)';
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        ticks: {
                            font: { size: 11 },
                            color: '#666',
                            padding: 8,
                            callback: function(value) {
                                return 'KES ' + (value / 1000) + 'K';
                            }
                        },
                        grid: {
                            color: '#e5e5e5',
                            drawBorder: false
                        }
                    },
                    y: {
                        ticks: {
                            font: { size: 11 },
                            color: '#666',
                            padding: 8
                        },
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

            // Comprehensive data structure for all categories and periods
            const dashboardData = {
                all: {
                    month: {
                        stats: { totalRevenue: 2450000, totalBookings: 127, productsSold: 342, avgRevenue: 19291 },
                        revenueTrend: { labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'], values: [550000, 600000, 650000, 650000] },
                        categoryBar: { labels: ['Accommodation', 'Marketplace', 'Tourism', 'Cultural'], values: [63, 18, 15, 4] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 1102500, percentage: 45.0 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 441000, percentage: 18.0 },
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 294000, percentage: 12.0 },
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 196000, percentage: 8.0 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 147000, percentage: 6.0 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 98000, percentage: 4.0 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 73500, percentage: 3.0 },
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 49000, percentage: 2.0 },
                            { name: 'Other Services', category: 'Miscellaneous', amount: 49000, percentage: 2.0 }
                        ]
                    },
                    quarter: {
                        stats: { totalRevenue: 585000, totalBookings: 38, productsSold: 102, avgRevenue: 15395 },
                        revenueTrend: { labels: ['Month 1', 'Month 2', 'Month 3'], values: [180000, 195000, 210000] },
                        categoryBar: { labels: ['Accommodation', 'Marketplace', 'Tourism', 'Cultural'], values: [60, 20, 16, 4] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 264600, percentage: 45.2 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 105840, percentage: 18.1 },
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 70560, percentage: 12.1 },
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 47040, percentage: 8.0 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 35280, percentage: 6.0 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 23520, percentage: 4.0 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 17640, percentage: 3.0 },
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 11760, percentage: 2.0 },
                            { name: 'Other Services', category: 'Miscellaneous', amount: 11760, percentage: 2.0 }
                        ]
                    },
                    year: {
                        stats: { totalRevenue: 2450000, totalBookings: 127, productsSold: 342, avgRevenue: 19291 },
                        revenueTrend: { labels: ['Q1', 'Q2', 'Q3', 'Q4'], values: [585000, 720000, 855000, 290000] },
                        categoryBar: { labels: ['Accommodation', 'Marketplace', 'Tourism', 'Cultural'], values: [63, 18, 15, 4] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 1102500, percentage: 45.0 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 441000, percentage: 18.0 },
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 294000, percentage: 12.0 },
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 196000, percentage: 8.0 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 147000, percentage: 6.0 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 98000, percentage: 4.0 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 73500, percentage: 3.0 },
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 49000, percentage: 2.0 },
                            { name: 'Other Services', category: 'Miscellaneous', amount: 49000, percentage: 2.0 }
                        ]
                    },
                    all: {
                        stats: { totalRevenue: 2450000, totalBookings: 127, productsSold: 342, avgRevenue: 19291 },
                        revenueTrend: { labels: revenueData.labels, values: revenueData.datasets[0].data },
                        categoryBar: { labels: ['Accommodation', 'Marketplace', 'Tourism', 'Cultural'], values: [63, 18, 15, 4] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 1102500, percentage: 45.0 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 441000, percentage: 18.0 },
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 294000, percentage: 12.0 },
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 196000, percentage: 8.0 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 147000, percentage: 6.0 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 98000, percentage: 4.0 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 73500, percentage: 3.0 },
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 49000, percentage: 2.0 },
                            { name: 'Other Services', category: 'Miscellaneous', amount: 49000, percentage: 2.0 }
                        ]
                    }
                },
                accommodation: {
                    month: {
                        stats: { totalRevenue: 1543500, totalBookings: 80, productsSold: 0, avgRevenue: 19294 },
                        revenueTrend: { labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'], values: [346500, 378000, 409500, 409500] },
                        categoryBar: { labels: ['Accommodation'], values: [100] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 1102500, percentage: 71.4 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 441000, percentage: 28.6 }
                        ]
                    },
                    quarter: {
                        stats: { totalRevenue: 370440, totalBookings: 19, productsSold: 0, avgRevenue: 19497 },
                        revenueTrend: { labels: ['Month 1', 'Month 2', 'Month 3'], values: [108000, 118800, 143640] },
                        categoryBar: { labels: ['Accommodation'], values: [100] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 264600, percentage: 71.4 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 105840, percentage: 28.6 }
                        ]
                    },
                    year: {
                        stats: { totalRevenue: 1543500, totalBookings: 80, productsSold: 0, avgRevenue: 19294 },
                        revenueTrend: { labels: ['Q1', 'Q2', 'Q3', 'Q4'], values: [370440, 453600, 453600, 265860] },
                        categoryBar: { labels: ['Accommodation'], values: [100] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 1102500, percentage: 71.4 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 441000, percentage: 28.6 }
                        ]
                    },
                    all: {
                        stats: { totalRevenue: 1543500, totalBookings: 80, productsSold: 0, avgRevenue: 19294 },
                        revenueTrend: { labels: revenueData.labels, values: revenueData.datasets[0].data.map(v => v * 0.63) },
                        categoryBar: { labels: ['Accommodation'], values: [100] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 1102500, percentage: 71.4 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 441000, percentage: 28.6 }
                        ]
                    }
                },
                marketplace: {
                    month: {
                        stats: { totalRevenue: 441000, totalBookings: 0, productsSold: 147, avgRevenue: 0 },
                        revenueTrend: { labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'], values: [110250, 132300, 132300, 66150] },
                        categoryBar: { labels: ['Marketplace'], values: [100] },
                        products: [
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 294000, percentage: 66.7 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 147000, percentage: 33.3 }
                        ]
                    },
                    quarter: {
                        stats: { totalRevenue: 105840, totalBookings: 0, productsSold: 35, avgRevenue: 0 },
                        revenueTrend: { labels: ['Month 1', 'Month 2', 'Month 3'], values: [35280, 35280, 35280] },
                        categoryBar: { labels: ['Marketplace'], values: [100] },
                        products: [
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 70560, percentage: 66.7 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 35280, percentage: 33.3 }
                        ]
                    },
                    year: {
                        stats: { totalRevenue: 441000, totalBookings: 0, productsSold: 147, avgRevenue: 0 },
                        revenueTrend: { labels: ['Q1', 'Q2', 'Q3', 'Q4'], values: [105840, 132300, 132300, 70560] },
                        categoryBar: { labels: ['Marketplace'], values: [100] },
                        products: [
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 294000, percentage: 66.7 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 147000, percentage: 33.3 }
                        ]
                    },
                    all: {
                        stats: { totalRevenue: 441000, totalBookings: 0, productsSold: 147, avgRevenue: 0 },
                        revenueTrend: { labels: revenueData.labels, values: revenueData.datasets[0].data.map(v => v * 0.18) },
                        categoryBar: { labels: ['Marketplace'], values: [100] },
                        products: [
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 294000, percentage: 66.7 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 147000, percentage: 33.3 }
                        ]
                    }
                },
                tourism: {
                    month: {
                        stats: { totalRevenue: 367500, totalBookings: 47, productsSold: 0, avgRevenue: 7829 },
                        revenueTrend: { labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'], values: [91900, 91900, 91900, 91800] },
                        categoryBar: { labels: ['Tourism'], values: [100] },
                        products: [
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 196000, percentage: 53.3 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 98000, percentage: 26.7 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 73500, percentage: 20.0 }
                        ]
                    },
                    quarter: {
                        stats: { totalRevenue: 88200, totalBookings: 11, productsSold: 0, avgRevenue: 8018 },
                        revenueTrend: { labels: ['Month 1', 'Month 2', 'Month 3'], values: [29400, 29400, 29400] },
                        categoryBar: { labels: ['Tourism'], values: [100] },
                        products: [
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 47040, percentage: 53.3 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 23520, percentage: 26.7 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 17640, percentage: 20.0 }
                        ]
                    },
                    year: {
                        stats: { totalRevenue: 367500, totalBookings: 47, productsSold: 0, avgRevenue: 7829 },
                        revenueTrend: { labels: ['Q1', 'Q2', 'Q3', 'Q4'], values: [88200, 110250, 110250, 58800] },
                        categoryBar: { labels: ['Tourism'], values: [100] },
                        products: [
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 196000, percentage: 53.3 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 98000, percentage: 26.7 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 73500, percentage: 20.0 }
                        ]
                    },
                    all: {
                        stats: { totalRevenue: 367500, totalBookings: 47, productsSold: 0, avgRevenue: 7829 },
                        revenueTrend: { labels: revenueData.labels, values: revenueData.datasets[0].data.map(v => v * 0.15) },
                        categoryBar: { labels: ['Tourism'], values: [100] },
                        products: [
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 196000, percentage: 53.3 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 98000, percentage: 26.7 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 73500, percentage: 20.0 }
                        ]
                    }
                },
                cultural: {
                    month: {
                        stats: { totalRevenue: 49000, totalBookings: 0, productsSold: 0, avgRevenue: 0 },
                        revenueTrend: { labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'], values: [12250, 12250, 12250, 12250] },
                        categoryBar: { labels: ['Cultural'], values: [100] },
                        products: [
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 49000, percentage: 100.0 }
                        ]
                    },
                    quarter: {
                        stats: { totalRevenue: 11760, totalBookings: 0, productsSold: 0, avgRevenue: 0 },
                        revenueTrend: { labels: ['Month 1', 'Month 2', 'Month 3'], values: [3920, 3920, 3920] },
                        categoryBar: { labels: ['Cultural'], values: [100] },
                        products: [
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 11760, percentage: 100.0 }
                        ]
                    },
                    year: {
                        stats: { totalRevenue: 49000, totalBookings: 0, productsSold: 0, avgRevenue: 0 },
                        revenueTrend: { labels: ['Q1', 'Q2', 'Q3', 'Q4'], values: [11760, 14700, 14700, 7840] },
                        categoryBar: { labels: ['Cultural'], values: [100] },
                        products: [
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 49000, percentage: 100.0 }
                        ]
                    },
                    all: {
                        stats: { totalRevenue: 49000, totalBookings: 0, productsSold: 0, avgRevenue: 0 },
                        revenueTrend: { labels: revenueData.labels, values: revenueData.datasets[0].data.map(v => v * 0.02) },
                        categoryBar: { labels: ['Cultural'], values: [100] },
                        products: [
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 49000, percentage: 100.0 }
                        ]
                    }
                }
            };

            // Function to update all dashboard values
            function updateDashboard(categoryFilter, periodFilter) {
                const category = categoryFilter.toLowerCase();
                const period = periodFilter.toLowerCase();
                
                const data = dashboardData[category] && dashboardData[category][period] 
                    ? dashboardData[category][period] 
                    : dashboardData['all'][period];

                // Update stats
                if (data.stats) {
                    const statBoxes = document.querySelectorAll('.stat-box');
                    if (statBoxes.length >= 4) {
                        const revenueValue = statBoxes[0].querySelector('.stat-box-value');
                        if (revenueValue) revenueValue.textContent = 'KES ' + data.stats.totalRevenue.toLocaleString();
                        
                        const bookingsValue = statBoxes[1].querySelector('.stat-box-value');
                        if (bookingsValue) bookingsValue.textContent = data.stats.totalBookings.toLocaleString();
                        
                        const productsValue = statBoxes[2].querySelector('.stat-box-value');
                        if (productsValue) productsValue.textContent = data.stats.productsSold.toLocaleString();
                        
                        const avgValue = statBoxes[3].querySelector('.stat-box-value');
                        if (avgValue) avgValue.textContent = data.stats.avgRevenue > 0 ? 'KES ' + data.stats.avgRevenue.toLocaleString() : 'N/A';
                    }
                }

                // Update revenue trend chart
                if (data.revenueTrend && typeof revenueTrendChart !== 'undefined') {
                    revenueTrendChart.data.labels = data.revenueTrend.labels;
                    revenueTrendChart.data.datasets[0].data = data.revenueTrend.values;
                    revenueTrendChart.update('active');
                }

                // Update category bar chart
                if (data.categoryBar && typeof categoryBarChart !== 'undefined' && data.stats) {
                    categoryBarChart.data.labels = data.categoryBar.labels;
                    // Convert percentages to actual amounts
                    const totalRevenue = data.stats.totalRevenue;
                    const amounts = data.categoryBar.values.map(percentage => {
                        return (totalRevenue * percentage) / 100;
                    });
                    categoryBarChart.data.datasets[0].data = amounts;
                    categoryBarChart.update('active');
                }

                // Update product performance chart
                if (data.products && typeof productPerformanceChart !== 'undefined') {
                    const topProducts = data.products.slice(0, 6);
                    productPerformanceChart.data.labels = topProducts.map(p => p.name.split(' ')[0]);
                    productPerformanceChart.data.datasets[0].data = topProducts.map(p => p.amount);
                    productPerformanceChart.update('active');
                }

            }

            // Get current active filters
            function getActiveFilters() {
                const activePeriod = document.querySelector('.time-period-btn.active')?.dataset.period || 'month';
                return { category: 'all', period: activePeriod };
            }

            // Time period selector with chart updates
            document.querySelectorAll('.time-period-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelectorAll('.time-period-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const filters = getActiveFilters();
                updateDashboard(filters.category, filters.period);
            });
            });


            // Load and display product sales
            let currentView = 'grid';
            
            // Hard-coded mock sales data for demonstration
            const mockSalesData = [
                {
                    productId: 1,
                    productName: "Decorative Maasai Gourd",
                    category: "home",
                    image: "products/Decorative_Maasai_Gourd_n7jkLBVdPq.jpg",
                    price: 5500,
                    quantity: 12,
                    totalRevenue: 66000,
                    firstSold: "2024-01-15T10:00:00Z",
                    lastSold: "2024-12-10T14:30:00Z"
                },
                {
                    productId: 3,
                    productName: "Maasai Shuka - Checked Designs",
                    category: "clothing",
                    image: "products/shuka_-_Checked_Designs_deTQrOs1Q3.jpg",
                    price: 2600,
                    quantity: 28,
                    totalRevenue: 72800,
                    firstSold: "2024-02-01T09:00:00Z",
                    lastSold: "2024-12-08T16:45:00Z"
                },
                {
                    productId: 5,
                    productName: "Thick Maasai Beaded Bangle",
                    category: "jewelry",
                    image: "products/A_multicolored_Maasai_beaded_bangle_with_a_vibrant_geometric_pattern,_featuring_a_variety_of_colored_67yTG7Yip1.jpg",
                    price: 3100,
                    quantity: 35,
                    totalRevenue: 108500,
                    firstSold: "2024-01-20T11:00:00Z",
                    lastSold: "2024-12-12T10:20:00Z"
                },
                {
                    productId: 4,
                    productName: "Maasai Gladiator Sandals",
                    category: "clothing",
                    image: "products/Sandals_Gladiator_Maasai_Sandals_Gladiator.jpg",
                    price: 4800,
                    quantity: 19,
                    totalRevenue: 91200,
                    firstSold: "2024-03-10T13:00:00Z",
                    lastSold: "2024-12-05T15:30:00Z"
                },
                {
                    productId: 8,
                    productName: "Maasai Grazer Painting",
                    category: "art",
                    image: "products/grazer_headed_home_DAY3-728.jpg",
                    price: 17800,
                    quantity: 5,
                    totalRevenue: 89000,
                    firstSold: "2024-04-15T10:00:00Z",
                    lastSold: "2024-11-28T12:00:00Z"
                },
                {
                    productId: 9,
                    productName: "Maasai Village Painting",
                    category: "art",
                    image: "products/Village_BT_-_219.jpg",
                    price: 13200,
                    quantity: 7,
                    totalRevenue: 92400,
                    firstSold: "2024-05-01T09:00:00Z",
                    lastSold: "2024-12-01T14:00:00Z"
                },
                {
                    productId: 7,
                    productName: "Handmade Maasai Beaded Pet Collar",
                    category: "home",
                    image: "products/Handmade_Maasai_Beaded_Leather_Pet_Collars_|_Wide_Dog_collars_25_096362c6-f87e-4f62-9c4d-0aab323704a0.png",
                    price: 3800,
                    quantity: 22,
                    totalRevenue: 83600,
                    firstSold: "2024-02-15T11:00:00Z",
                    lastSold: "2024-12-09T13:15:00Z"
                },
                {
                    productId: 2,
                    productName: "Maasai Red Black Slippers",
                    category: "clothing",
                    image: "products/red_black_slippers_IVicECwcFj.jpg",
                    price: 3700,
                    quantity: 15,
                    totalRevenue: 55500,
                    firstSold: "2024-03-05T10:00:00Z",
                    lastSold: "2024-12-07T11:30:00Z"
                },
                {
                    productId: 6,
                    productName: "Maasai Coloring Book",
                    category: "art",
                    image: "products/Color_with_Kilel:_A_Coloring_Journey_through_Maasai_Culture_and_Traditions_BserLvoEol.jpg",
                    price: 3000,
                    quantity: 18,
                    totalRevenue: 54000,
                    firstSold: "2024-01-25T09:00:00Z",
                    lastSold: "2024-12-06T15:00:00Z"
                },
                {
                    productId: 10,
                    productName: "African Landscape - Grazing",
                    category: "art",
                    image: "products/grazing_BT_-_96.jpg",
                    price: 19000,
                    quantity: 4,
                    totalRevenue: 76000,
                    firstSold: "2024-06-10T10:00:00Z",
                    lastSold: "2024-11-20T14:00:00Z"
                }
            ];
            
            function loadProductSales(view = 'grid') {
                // Use mock data if no real sales data exists, otherwise merge them
                const realSalesData = JSON.parse(localStorage.getItem('productSales') || '[]');
                let salesData = realSalesData.length > 0 ? realSalesData : mockSalesData;
                
                // If we have real data, merge with mock data (avoid duplicates)
                if (realSalesData.length > 0) {
                    mockSalesData.forEach(mockSale => {
                        const existing = salesData.find(s => s.productId === mockSale.productId);
                        if (!existing) {
                            salesData.push(mockSale);
                        }
                    });
                }
                
                const salesTable = document.getElementById('productSalesTable');
                
                if (salesData.length === 0) {
                    salesTable.innerHTML = `
                        <div style="text-align: center; padding: 4rem 2rem; background: white; border-radius: 16px; border: 2px dashed rgba(212, 165, 116, 0.3);">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">📦</div>
                            <p style="color: var(--text-light); font-size: 1.1rem; margin: 0;">No product sales data available yet.</p>
                            <p style="color: var(--text-light); font-size: 0.9rem; margin-top: 0.5rem;">Sales will appear here once customers make purchases.</p>
                        </div>
                    `;
                    return;
                }
                
                // Sort by quantity sold (descending)
                salesData.sort((a, b) => b.quantity - a.quantity);
                
                if (view === 'grid') {
                    // Grid View - Card Layout
                    let gridHTML = `
                        <div class="sales-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem;">
                    `;
                    
                    salesData.forEach((sale, index) => {
                        const productImage = sale.image || 'data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 200 200%27%3E%3Crect fill=%27%23f3f4f6%27 width=%27200%27 height=%27200%27/%3E%3Ctext fill=%27%239ca3af%27 font-family=%27sans-serif%27 font-size=%2714%27 x=%2750%25%27 y=%2750%25%27 text-anchor=%27middle%27 dy=%27.3em%27%3ENo Image%3C/text%3E%3C/svg%3E';
                        const productLink = `product.html?id=${sale.productId}`;
                        const badgeColor = index < 3 ? 'var(--primary-color)' : 'rgba(212, 165, 116, 0.3)';
                        
                        gridHTML += `
                            <a href="${productLink}" style="text-decoration: none; color: inherit; display: block;">
                                <div class="sales-card" style="background: white; border-radius: 16px; overflow: hidden; border: 2px solid rgba(212, 165, 116, 0.1); transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.08); height: 100%; display: flex; flex-direction: column;">
                                    <div style="position: relative; width: 100%; padding-top: 75%; background: linear-gradient(135deg, rgba(212, 165, 116, 0.1) 0%, rgba(44, 85, 48, 0.05) 100%); overflow: hidden;">
                                        <img src="${productImage}" alt="${sale.productName}" 
                                             style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;"
                                             onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 200 200%27%3E%3Crect fill=%27%23f3f4f6%27 width=%27200%27 height=%27200%27/%3E%3Ctext fill=%27%239ca3af%27 font-family=%27sans-serif%27 font-size=%2714%27 x=%2750%25%27 y=%2750%25%27 text-anchor=%27middle%27 dy=%27.3em%27%3ENo Image%3C/text%3E%3C/svg%3E'">
                                        ${index < 3 ? `<div style="position: absolute; top: 0.75rem; right: 0.75rem; background: ${badgeColor}; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 700; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">#${index + 1}</div>` : ''}
                                    </div>
                                    <div style="padding: 1.25rem; flex: 1; display: flex; flex-direction: column;">
                                        <div style="display: flex; align-items: start; justify-content: space-between; margin-bottom: 0.75rem;">
                                            <h3 style="font-size: 1.1rem; font-weight: 700; color: var(--secondary-color); margin: 0; line-height: 1.3; flex: 1;">${sale.productName}</h3>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                                            <span style="padding: 0.25rem 0.75rem; background: rgba(212, 165, 116, 0.1); color: var(--primary-color); border-radius: 12px; font-size: 0.75rem; font-weight: 600; text-transform: capitalize;">${sale.category}</span>
                                        </div>
                                        <div style="margin-top: auto; padding-top: 1rem; border-top: 1px solid rgba(212, 165, 116, 0.1);">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                                <span style="font-size: 0.875rem; color: var(--text-light); font-weight: 500;">Quantity Sold:</span>
                                                <span style="font-size: 1.5rem; font-weight: 700; color: var(--secondary-color);">${sale.quantity}</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                                <span style="font-size: 0.875rem; color: var(--text-light); font-weight: 500;">Total Revenue:</span>
                                                <span style="font-size: 1.25rem; font-weight: 700; color: var(--primary-color);">KES ${sale.totalRevenue.toLocaleString()}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        `;
                    });
                    
                    gridHTML += `</div>`;
                    salesTable.innerHTML = gridHTML;
                    
                    // Add hover effects
                    salesTable.querySelectorAll('a > div').forEach(card => {
                        card.addEventListener('mouseenter', function() {
                            this.style.transform = 'translateY(-4px)';
                            this.style.boxShadow = '0 8px 24px rgba(0,0,0,0.12)';
                            this.style.borderColor = 'var(--primary-color)';
                            const img = this.querySelector('img');
                            if (img) img.style.transform = 'scale(1.05)';
                        });
                        card.addEventListener('mouseleave', function() {
                            this.style.transform = 'translateY(0)';
                            this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.08)';
                            this.style.borderColor = 'rgba(212, 165, 116, 0.1)';
                            const img = this.querySelector('img');
                            if (img) img.style.transform = 'scale(1)';
                        });
                    });
                } else {
                    // List View - Table Layout
                    let tableHTML = `
                        <div style="overflow-x: auto; background: white; border-radius: 16px; border: 2px solid rgba(212, 165, 116, 0.1); overflow: hidden;">
                            <table class="sales-table" style="width: 100%; border-collapse: collapse; min-width: 600px;">
                                <thead>
                                    <tr style="background: linear-gradient(135deg, rgba(212, 165, 116, 0.1) 0%, rgba(44, 85, 48, 0.05) 100%);">
                                        <th style="padding: 1.25rem; text-align: left; font-weight: 600; color: var(--secondary-color); border-bottom: 2px solid rgba(212, 165, 116, 0.2);">Product</th>
                                        <th style="padding: 1.25rem; text-align: left; font-weight: 600; color: var(--secondary-color); border-bottom: 2px solid rgba(212, 165, 116, 0.2);">Category</th>
                                        <th style="padding: 1.25rem; text-align: center; font-weight: 600; color: var(--secondary-color); border-bottom: 2px solid rgba(212, 165, 116, 0.2);">Quantity Sold</th>
                                        <th style="padding: 1.25rem; text-align: right; font-weight: 600; color: var(--secondary-color); border-bottom: 2px solid rgba(212, 165, 116, 0.2);">Total Revenue</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    salesData.forEach((sale, index) => {
                        const productImage = sale.image || 'data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 200 200%27%3E%3Crect fill=%27%23f3f4f6%27 width=%27200%27 height=%27200%27/%3E%3Ctext fill=%27%239ca3af%27 font-family=%27sans-serif%27 font-size=%2714%27 x=%2750%25%27 y=%2750%25%27 text-anchor=%27middle%27 dy=%27.3em%27%3ENo Image%3C/text%3E%3C/svg%3E';
                        const productLink = `product.html?id=${sale.productId}`;
                        const rowStyle = index % 2 === 0 ? 'background: rgba(212, 165, 116, 0.02);' : 'background: white;';
                        
                        tableHTML += `
                            <tr style="${rowStyle} transition: background 0.2s ease;">
                                <td style="padding: 1.25rem;">
                                    <a href="${productLink}" style="display: flex; align-items: center; gap: 1rem; text-decoration: none; color: inherit;">
                                        <img src="${productImage}" alt="${sale.productName}" 
                                             style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; border: 2px solid rgba(212, 165, 116, 0.2);"
                                             onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 200 200%27%3E%3Crect fill=%27%23f3f4f6%27 width=%27200%27 height=%27200%27/%3E%3Ctext fill=%27%239ca3af%27 font-family=%27sans-serif%27 font-size=%2714%27 x=%2750%25%27 y=%2750%25%27 text-anchor=%27middle%27 dy=%27.3em%27%3ENo Image%3C/text%3E%3C/svg%3E'">
                                        <div>
                                            <div style="font-weight: 600; color: var(--text-dark); margin-bottom: 0.25rem;">${sale.productName}</div>
                                            <div style="font-size: 0.875rem; color: var(--text-light);">View Product →</div>
                                        </div>
                                    </a>
                                </td>
                                <td style="padding: 1.25rem;">
                                    <span style="padding: 0.375rem 0.75rem; background: rgba(212, 165, 116, 0.1); color: var(--primary-color); border-radius: 12px; font-size: 0.875rem; font-weight: 600; text-transform: capitalize;">${sale.category}</span>
                                </td>
                                <td style="padding: 1.25rem; text-align: center;">
                                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(44, 85, 48, 0.1); padding: 0.5rem 1rem; border-radius: 8px;">
                                        <span style="font-size: 1.5rem; font-weight: 700; color: var(--secondary-color);">${sale.quantity}</span>
                                        <span style="font-size: 0.875rem; color: var(--text-light);">units</span>
                                    </div>
                                </td>
                                <td style="padding: 1.25rem; text-align: right;">
                                    <div style="font-size: 1.25rem; font-weight: 700; color: var(--primary-color);">KES ${sale.totalRevenue.toLocaleString()}</div>
                                </td>
                            </tr>
                        `;
                    });
                    
                    tableHTML += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    salesTable.innerHTML = tableHTML;
                }
            }
            
            // View toggle functionality
            document.querySelectorAll('.sales-view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.sales-view-btn').forEach(b => {
                        b.classList.remove('active');
                        b.style.background = 'transparent';
                        b.style.color = 'var(--text-light)';
                    });
                    this.classList.add('active');
                    this.style.background = 'rgba(212, 165, 116, 0.1)';
                    this.style.color = 'var(--secondary-color)';
                    currentView = this.dataset.view;
                    loadProductSales(currentView);
                });
            });
            
            // Load product sales on page load
            loadProductSales(currentView);

            // Logout functionality
            document.getElementById('logoutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('Are you sure you want to logout?')) {
                    // Clear both authentication methods
                    localStorage.removeItem('communityAuthenticated');
                    localStorage.removeItem('communityLoginTime');
                    sessionStorage.removeItem('communityLoggedIn');
                    sessionStorage.removeItem('communityUsername');
                    window.location.href = 'community.html';
                }
            });
        }); // End of DOMContentLoaded
    </script>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Il Ngwesi Conservancy</h3>
                    <p>People of Wildlife</p>
                    <p>Community-owned and operated tourism</p>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <p>Email: info@ilngwesi.com</p>
                    <p>Phone: +254 (0) 741 770 540</p>
                    <p>Tourism Steward: Available 7AM-7PM</p>
                </div>
                <div class="footer-section">
                    <h4>Location</h4>
                    <p>Il Ngwesi Group Ranch</p>
                    <p>Laikipia County, Kenya</p>
                    <p>Via Lewa Wildlife Conservancy</p>
                </div>
                <div class="footer-section">
                    <h4>System</h4>
                    <p>Powered by Community Tourism Relay</p>
                    <p>Low-tech, community-owned booking system</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Il Ngwesi Conservancy. All rights reserved.</p>
            </div>
        </div>
    </footer>
</body>
</html>
