<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="description" content="Dashibodi ya Mapato - Il Ngwesi Conservancy">
    <meta name="theme-color" content="#d4a574">
    <title>Dashibodi ya Mapato - Il Ngwesi Conservancy</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* Modern, fluid, inspiring dashboard design */
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
        }

        .navbar {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%) !important;
            backdrop-filter: blur(20px) !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3) !important;
        }

        .nav-brand h1 {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .dashboard {
            padding: 1.5rem;
            background: transparent;
            min-height: 100vh;
        }

        .dashboard-header {
            background: transparent;
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            margin-left: 0;
            padding-left: 0;
            border-bottom: 2px solid rgba(212, 165, 116, 0.2);
        }

        .dashboard-header h1 {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 0.5rem 0;
            padding-left: 0;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .dashboard-header p {
            color: #64748b;
            font-size: 1rem;
            margin: 0;
            padding-left: 0;
            font-weight: 400;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid rgba(212, 165, 116, 0.15);
        }

        .stat-box {
            background: transparent;
            padding: 0;
            transition: all 0.3s ease;
            position: relative;
        }

        .stat-box:hover {
            transform: translateX(4px);
        }

        .stat-box-label {
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .stat-box-value-wrapper {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .stat-box-value {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .stat-box-change {
            font-size: 0.7rem;
            color: #10b981;
            font-weight: 500;
        }

        .revenue-breakdown {
            background: transparent;
            padding: 0;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid rgba(212, 165, 116, 0.15);
        }

        .revenue-breakdown h2 {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 1.5rem 0;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        .chart-container {
            background: transparent;
            padding: 0;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid rgba(212, 165, 116, 0.15);
        }

        .chart-container:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .chart-container h2 {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 1.5rem 0;
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .chart-container canvas {
            max-height: 300px;
        }

        /* Revenue Table Styles - Card Based */
        .revenue-table {
            width: 100%;
        }

        .revenue-table-header {
            display: none;
        }

        .revenue-table-body {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0;
        }

        .revenue-row {
            background: transparent;
            border: none;
            border-left: 3px solid transparent;
            border-bottom: 1px solid rgba(212, 165, 116, 0.1);
            border-radius: 0;
            padding: 1rem 1rem 1rem 0;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            position: relative;
        }

        .revenue-row:last-child {
            border-bottom: none;
        }

        .revenue-row::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, #d4a574 0%, #b8935f 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .revenue-row:hover {
            transform: translateX(8px);
            border-left-color: #d4a574;
        }

        .revenue-row:hover::before {
            opacity: 1;
        }

        .revenue-row.hidden {
            display: none;
        }

        .revenue-col-name {
            font-weight: 600;
            color: #1e293b;
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
            line-height: 1.4;
            letter-spacing: -0.01em;
        }

        .revenue-col-category {
            margin-bottom: 0.5rem;
        }

        .revenue-col-amount {
            font-weight: 700;
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
            letter-spacing: -0.02em;
        }

        .revenue-col-percentage {
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
        }

        .revenue-col-chart {
            margin-top: 0.25rem;
        }

        .revenue-row-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .revenue-row-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .category-badge {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 0.75rem;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .category-badge.accommodation {
            background: #d4a574;
        }

        .category-badge.marketplace {
            background: #2c5530;
        }

        .category-badge.tourism {
            background: #8b4513;
        }

        .category-badge.cultural {
            background: #b8935f;
        }

        .category-badge.miscellaneous {
            background: #6b7280;
        }

        .percentage-badge {
            font-weight: 600;
            color: #64748b;
            font-size: 0.9rem;
            letter-spacing: 0.01em;
        }

        .revenue-bar {
            width: 100%;
            height: 10px;
            background: rgba(229, 229, 229, 0.5);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .revenue-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #d4a574 0%, #b8935f 100%);
            border-radius: 10px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(212, 165, 116, 0.4);
        }

        .filter-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            border-radius: 0;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            color: #64748b;
            transition: all 0.3s ease;
            position: relative;
            border-bottom: 2px solid transparent;
        }

        .filter-btn:hover {
            color: #2c5530;
        }

        .filter-btn.active {
            color: #2c5530;
            border-bottom-color: #d4a574;
            font-weight: 600;
        }

        .time-period-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .category-filters-section {
            background: transparent;
            padding: 0;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(212, 165, 116, 0.15);
        }

        .category-filters-section h2 {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 1.25rem 0;
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .category-filters-label {
            font-weight: 600;
            color: #666;
            margin-bottom: 0.75rem;
            font-size: 0.85rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .time-period-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            border-radius: 0;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            color: #64748b;
            transition: all 0.3s ease;
            position: relative;
            border-bottom: 2px solid transparent;
        }

        .time-period-btn:hover {
            color: #2c5530;
        }

        .time-period-btn.active {
            color: #2c5530;
            border-bottom-color: #d4a574;
            font-weight: 600;
        }


        @media (min-width: 768px) {
            .dashboard {
                padding: 2.5rem;
            }

            .dashboard-header {
                padding: 2.5rem 0;
                padding-left: 0;
            }

            .dashboard-header h1 {
                font-size: 2.5rem;
            }

            .dashboard-stats {
                grid-template-columns: repeat(4, 1fr);
                gap: 1.5rem;
            }

            .stat-box {
                padding: 2rem;
            }

            .stat-box-value {
                font-size: 1.5rem;
            }

            .revenue-table-body {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .chart-container {
                padding: 2.5rem;
            }

            .chart-container canvas {
                max-height: 400px;
            }

            .revenue-breakdown {
                padding: 2.5rem;
            }
        }

        @media (min-width: 1024px) {
            .revenue-table-body {
                grid-template-columns: repeat(3, 1fr);
            }

            .dashboard {
                padding: 3rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1>Il Ngwesi</h1>
                <span class="tagline">Dashibodi ya Mapato</span>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">Rudi kwenye Tovuti</a></li>
                <li><a href="#" id="logoutBtn" style="color: #dc2626;">Toka</a></li>
            </ul>
        </div>
    </nav>

    <!-- Dashboard -->
    <section class="dashboard" style="margin-top: 80px;">
        <div class="container">
            <div class="dashboard-header">
                <h1>Dashibodi ya Mapato</h1>
                <p>Ufuatiliaji wa mapato na viashiria vya utendaji</p>
            </div>

            <!-- Time Period Selector -->
            <div class="time-period-selector">
                <button class="time-period-btn active" data-period="month">Mwezi</button>
                <button class="time-period-btn" data-period="quarter">Robo</button>
                <button class="time-period-btn" data-period="year">Mwaka</button>
                <button class="time-period-btn" data-period="all">Wakati Wote</button>
            </div>

            <!-- Summary Stats -->
            <div class="dashboard-stats">
                <div class="stat-box">
                    <div class="stat-box-label">Jumla ya Mapato</div>
                    <div class="stat-box-value-wrapper">
                        <div class="stat-box-value">KES 2,450,000</div>
                        <div class="stat-box-change">↑ 12%</div>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-label">Maajiri</div>
                    <div class="stat-box-value-wrapper">
                        <div class="stat-box-value">127</div>
                        <div class="stat-box-change">↑ 8%</div>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-label">Bidhaa</div>
                    <div class="stat-box-value-wrapper">
                        <div class="stat-box-value">342</div>
                        <div class="stat-box-change">↑ 15%</div>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-label">Wastani/Kiajiri</div>
                    <div class="stat-box-value-wrapper">
                        <div class="stat-box-value">KES 19,291</div>
                        <div class="stat-box-change">↑ 4%</div>
                    </div>
                </div>
            </div>

            <!-- Category Filters -->
            <div class="category-filters-section">
                <h2>Mapato kwa Bidhaa/Huduma</h2>
                <div class="category-filters-label">Chagua Kategoria:</div>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all">Zote</button>
                    <button class="filter-btn" data-filter="accommodation">Malazi</button>
                    <button class="filter-btn" data-filter="marketplace">Soko</button>
                    <button class="filter-btn" data-filter="tourism">Utalii</button>
                    <button class="filter-btn" data-filter="cultural">Kitamaduni</button>
                </div>
            </div>

            <!-- Revenue Breakdown by Product/Service -->
            <div class="revenue-breakdown">
                <h2>Mapato kwa Bidhaa/Huduma</h2>
                <div class="revenue-table">
                    <div class="revenue-table-body">
                        <div class="revenue-row" data-category="Accommodation">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                <span class="category-badge accommodation"></span>
                                <div class="revenue-col-name">Il Ngwesi Ecolodge</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                                <div class="revenue-col-amount">KES 1.1M</div>
                                <div class="percentage-badge">45%</div>
                            </div>
                            <div class="revenue-col-chart">
                                <div class="revenue-bar">
                                    <div class="revenue-bar-fill" data-percentage="45" style="width: 45%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="revenue-row" data-category="Accommodation">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                <span class="category-badge accommodation"></span>
                                <div class="revenue-col-name">Community Homestays</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                                <div class="revenue-col-amount">KES 441K</div>
                                <div class="percentage-badge">18%</div>
                            </div>
                            <div class="revenue-col-chart">
                                <div class="revenue-bar">
                                    <div class="revenue-bar-fill" data-percentage="18" style="width: 18%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="revenue-row" data-category="Marketplace">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                <span class="category-badge marketplace"></span>
                                <div class="revenue-col-name">Beaded Jewelry</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                                <div class="revenue-col-amount">KES 294K</div>
                                <div class="percentage-badge">12%</div>
                            </div>
                            <div class="revenue-col-chart">
                                <div class="revenue-bar">
                                    <div class="revenue-bar-fill" data-percentage="12" style="width: 12%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="revenue-row" data-category="Tourism">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                <span class="category-badge tourism"></span>
                                <div class="revenue-col-name">Guided Wildlife Walks</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                                <div class="revenue-col-amount">KES 196K</div>
                                <div class="percentage-badge">8%</div>
                            </div>
                            <div class="revenue-col-chart">
                                <div class="revenue-bar">
                                    <div class="revenue-bar-fill" data-percentage="8" style="width: 8%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="revenue-row" data-category="Marketplace">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <span class="category-badge marketplace"></span>
                                <div class="revenue-col-name">Traditional Bags</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <div class="revenue-col-amount">KES 147K</div>
                                <div class="percentage-badge">6%</div>
                            </div>
                            <div class="revenue-col-chart">
                                <div class="revenue-bar">
                                    <div class="revenue-bar-fill" data-percentage="6" style="width: 6%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="revenue-row" data-category="Tourism">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <span class="category-badge tourism"></span>
                                <div class="revenue-col-name">Cultural Evenings</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <div class="revenue-col-amount">KES 98K</div>
                                <div class="percentage-badge">4%</div>
                            </div>
                            <div class="revenue-col-chart">
                                <div class="revenue-bar">
                                    <div class="revenue-bar-fill" data-percentage="4" style="width: 4%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="revenue-row" data-category="Tourism">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <span class="category-badge tourism"></span>
                                <div class="revenue-col-name">Bush Breakfasts</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <div class="revenue-col-amount">KES 73.5K</div>
                                <div class="percentage-badge">3%</div>
                            </div>
                            <div class="revenue-col-chart">
                                <div class="revenue-bar">
                                    <div class="revenue-bar-fill" data-percentage="3" style="width: 3%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="revenue-row" data-category="Cultural">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                <span class="category-badge cultural"></span>
                                <div class="revenue-col-name">Manyatta Experiences</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                                <div class="revenue-col-amount">KES 49K</div>
                                <div class="percentage-badge">2%</div>
                            </div>
                            <div class="revenue-col-chart">
                                <div class="revenue-bar">
                                    <div class="revenue-bar-fill" data-percentage="2" style="width: 2%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="revenue-row" data-category="Miscellaneous">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                <span class="category-badge miscellaneous"></span>
                                <div class="revenue-col-name">Other Services</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                                <div class="revenue-col-amount">KES 49K</div>
                                <div class="percentage-badge">2%</div>
                            </div>
                            <div class="revenue-col-chart">
                                <div class="revenue-bar">
                                    <div class="revenue-bar-fill" data-percentage="2" style="width: 2%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Revenue Trends Chart -->
            <div class="chart-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                    <h2 style="margin: 0;">Mienendo ya Mapato Kwa Muda</h2>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <div style="background: linear-gradient(135deg, #fef3e7 0%, #fde68a 100%); padding: 0.75rem 1.25rem; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                            <div style="font-size: 0.75rem; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.25rem;">Mwezi wa Kilele</div>
                            <div style="font-size: 1.1rem; font-weight: 700; color: var(--secondary-color);">Nov: KES 330K</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 0.75rem 1.25rem; border-radius: 8px; border-left: 4px solid #10b981;">
                            <div style="font-size: 0.75rem; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.25rem;">Ukuaji</div>
                            <div style="font-size: 1.1rem; font-weight: 700; color: #10b981;">↑ 36.1%</div>
                        </div>
                    </div>
                </div>
                <canvas id="revenueTrendChart"></canvas>
            </div>

            <!-- Revenue by Category Pie Chart -->
            <div class="chart-container">
                <h2>Mapato kwa Kategoria</h2>
                <canvas id="categoryPieChart"></canvas>
            </div>

            <!-- Revenue by Category Bar Chart -->
            <div class="chart-container">
                <h2>Mapato kwa Kategoria</h2>
                <canvas id="categoryBarChart"></canvas>
            </div>

            <!-- Product Performance Chart -->
            <div class="chart-container">
                <h2>Utendaji wa Bidhaa Bora</h2>
                <canvas id="productPerformanceChart"></canvas>
            </div>

        </div>
    </section>

    <script>
        // Authentication check - protect dashboard
        (function() {
            // Wait for DOM to be ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', checkAuth);
            } else {
                checkAuth();
            }
            
            function checkAuth() {
                const isAuthenticated = localStorage.getItem('communityAuthenticated') === 'true';
                
                console.log('Dashboard auth check:', isAuthenticated);
                
                if (!isAuthenticated) {
                    // Redirect to login page
                    console.log('Not authenticated, redirecting to login...');
                    window.location.replace('login.html');
                    return;
                }

                // Check if session is still valid (24 hours)
                const loginTime = localStorage.getItem('communityLoginTime');
                if (loginTime) {
                    const loginDate = new Date(loginTime);
                    const now = new Date();
                    const hoursDiff = (now - loginDate) / (1000 * 60 * 60);
                    
                    if (hoursDiff > 24) {
                        // Session expired
                        console.log('Session expired, redirecting to login...');
                        localStorage.removeItem('communityAuthenticated');
                        localStorage.removeItem('communityLoginTime');
                        window.location.replace('login.html');
                        return;
                    }
                }
                
                console.log('Authentication successful, dashboard loaded');
            }
        })();

        // Wait for DOM to be fully loaded before initializing charts
        document.addEventListener('DOMContentLoaded', function() {
        // Chart.js configuration - Simple and clean
        Chart.defaults.font.family = 'Inter, sans-serif';
        Chart.defaults.font.size = 12;
        Chart.defaults.color = '#333';

            // Revenue data
            const revenueTrendCtx = document.getElementById('revenueTrendChart').getContext('2d');
            const revenueData = {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [{
                label: 'Revenue (KES)',
                data: [180000, 195000, 210000, 225000, 240000, 255000, 270000, 285000, 300000, 315000, 330000, 245000],
                borderColor: '#d4a574',
                backgroundColor: 'rgba(212, 165, 116, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.4,
                pointRadius: 3,
                pointHoverRadius: 5
            }]
        };

            // Revenue Trends Line Chart
            const revenueTrendChart = new Chart(revenueTrendCtx, {
            type: 'line',
            data: revenueData,
            options: {
                responsive: true,
                maintainAspectRatio: true,
                aspectRatio: 2,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 8,
                        titleFont: { size: 12 },
                        bodyFont: { size: 11 },
                        callbacks: {
                            label: function(context) {
                                return 'KES ' + context.parsed.y.toLocaleString();
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'KES ' + (value / 1000) + 'K';
                            },
                            font: { size: 11 },
                            color: '#666',
                            padding: 8
                        },
                        grid: {
                            color: '#e5e5e5',
                            drawBorder: false
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            font: { size: 11 },
                            color: '#666',
                            padding: 8
                        }
                    }
                }
            }
        });

            // Category Pie Chart
            const categoryPieCtx = document.getElementById('categoryPieChart').getContext('2d');
            const categoryPieChart = new Chart(categoryPieCtx, {
            type: 'pie',
            data: {
                labels: ['Malazi', 'Soko', 'Utalii', 'Kitamaduni'],
                datasets: [{
                    label: 'Mapato %',
                    data: [63, 18, 15, 4],
                    backgroundColor: [
                        'rgba(212, 165, 116, 0.8)',
                        'rgba(44, 85, 48, 0.8)',
                        'rgba(139, 69, 19, 0.8)',
                        'rgba(184, 147, 95, 0.8)'
                    ],
                    borderColor: [
                        '#d4a574',
                        '#2c5530',
                        '#8b4513',
                        '#b8935f'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            font: { size: 11 },
                            color: '#666',
                            padding: 12
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 8,
                        titleFont: { size: 12 },
                        bodyFont: { size: 11 },
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed + '% ya mapato yote';
                            }
                        }
                    }
                }
            }
        });

            // Category Bar Chart
            const categoryBarCtx = document.getElementById('categoryBarChart').getContext('2d');
            const categoryBarChart = new Chart(categoryBarCtx, {
            type: 'bar',
            data: {
                labels: ['Malazi', 'Soko', 'Utalii', 'Kitamaduni'],
                datasets: [{
                    label: 'Mapato %',
                    data: [63, 18, 15, 4],
                    backgroundColor: [
                        'rgba(212, 165, 116, 0.8)',
                        'rgba(44, 85, 48, 0.8)',
                        'rgba(139, 69, 19, 0.8)',
                        'rgba(184, 147, 95, 0.8)'
                    ],
                    borderColor: [
                        '#d4a574',
                        '#2c5530',
                        '#8b4513',
                        '#b8935f'
                    ],
                    borderWidth: 2,
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 8,
                        titleFont: { size: 12 },
                        bodyFont: { size: 11 },
                        callbacks: {
                            label: function(context) {
                                return context.parsed.y + '% ya mapato yote';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            font: { size: 11 },
                            color: '#666',
                            padding: 8,
                            callback: function(value) {
                                return value + '%';
                            }
                        },
                        grid: {
                            color: '#e5e5e5',
                            drawBorder: false
                        }
                    },
                    x: {
                        ticks: {
                            font: { size: 11 },
                            color: '#666',
                            padding: 8
                        },
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

            // Product Performance Chart
            const productPerformanceCtx = document.getElementById('productPerformanceChart').getContext('2d');
            const productPerformanceChart = new Chart(productPerformanceCtx, {
            type: 'bar',
            data: {
                labels: ['Ecolodge', 'Malazi ya Jumuiya', 'Vito', 'Tembea Wanyama', 'Mifuko', 'Jioni za Kitamaduni'],
                datasets: [{
                    label: 'Mapato (KES)',
                    data: [1102500, 441000, 294000, 196000, 147000, 98000],
                    backgroundColor: function(context) {
                        const value = context.parsed.y;
                        if (value > 800000) return 'rgba(212, 165, 116, 0.9)';
                        if (value > 400000) return 'rgba(212, 165, 116, 0.7)';
                        return 'rgba(212, 165, 116, 0.5)';
                    },
                    borderColor: '#d4a574',
                    borderWidth: 2,
                    borderRadius: 6
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 8,
                        titleFont: { size: 12 },
                        bodyFont: { size: 11 },
                        callbacks: {
                            label: function(context) {
                                const percentage = ((context.parsed.x / 2450000) * 100).toFixed(1);
                                return 'KES ' + context.parsed.x.toLocaleString() + ' (' + percentage + '%)';
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        ticks: {
                            font: { size: 11 },
                            color: '#666',
                            padding: 8,
                            callback: function(value) {
                                return 'KES ' + (value / 1000) + 'K';
                            }
                        },
                        grid: {
                            color: '#e5e5e5',
                            drawBorder: false
                        }
                    },
                    y: {
                        ticks: {
                            font: { size: 11 },
                            color: '#666',
                            padding: 8
                        },
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

            // Comprehensive data structure for all categories and periods
            const dashboardData = {
                all: {
                    month: {
                        stats: { totalRevenue: 2450000, totalBookings: 127, productsSold: 342, avgRevenue: 19291 },
                        revenueTrend: { labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'], values: [550000, 600000, 650000, 650000] },
                        categoryBar: { labels: ['Accommodation', 'Marketplace', 'Tourism', 'Cultural'], values: [63, 18, 15, 4] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 1102500, percentage: 45.0 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 441000, percentage: 18.0 },
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 294000, percentage: 12.0 },
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 196000, percentage: 8.0 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 147000, percentage: 6.0 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 98000, percentage: 4.0 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 73500, percentage: 3.0 },
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 49000, percentage: 2.0 },
                            { name: 'Other Services', category: 'Miscellaneous', amount: 49000, percentage: 2.0 }
                        ]
                    },
                    quarter: {
                        stats: { totalRevenue: 585000, totalBookings: 38, productsSold: 102, avgRevenue: 15395 },
                        revenueTrend: { labels: ['Month 1', 'Month 2', 'Month 3'], values: [180000, 195000, 210000] },
                        categoryBar: { labels: ['Accommodation', 'Marketplace', 'Tourism', 'Cultural'], values: [60, 20, 16, 4] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 264600, percentage: 45.2 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 105840, percentage: 18.1 },
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 70560, percentage: 12.1 },
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 47040, percentage: 8.0 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 35280, percentage: 6.0 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 23520, percentage: 4.0 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 17640, percentage: 3.0 },
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 11760, percentage: 2.0 },
                            { name: 'Other Services', category: 'Miscellaneous', amount: 11760, percentage: 2.0 }
                        ]
                    },
                    year: {
                        stats: { totalRevenue: 2450000, totalBookings: 127, productsSold: 342, avgRevenue: 19291 },
                        revenueTrend: { labels: ['Q1', 'Q2', 'Q3', 'Q4'], values: [585000, 720000, 855000, 290000] },
                        categoryBar: { labels: ['Accommodation', 'Marketplace', 'Tourism', 'Cultural'], values: [63, 18, 15, 4] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 1102500, percentage: 45.0 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 441000, percentage: 18.0 },
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 294000, percentage: 12.0 },
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 196000, percentage: 8.0 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 147000, percentage: 6.0 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 98000, percentage: 4.0 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 73500, percentage: 3.0 },
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 49000, percentage: 2.0 },
                            { name: 'Other Services', category: 'Miscellaneous', amount: 49000, percentage: 2.0 }
                        ]
                    },
                    all: {
                        stats: { totalRevenue: 2450000, totalBookings: 127, productsSold: 342, avgRevenue: 19291 },
                        revenueTrend: { labels: revenueData.labels, values: revenueData.datasets[0].data },
                        categoryBar: { labels: ['Accommodation', 'Marketplace', 'Tourism', 'Cultural'], values: [63, 18, 15, 4] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 1102500, percentage: 45.0 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 441000, percentage: 18.0 },
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 294000, percentage: 12.0 },
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 196000, percentage: 8.0 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 147000, percentage: 6.0 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 98000, percentage: 4.0 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 73500, percentage: 3.0 },
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 49000, percentage: 2.0 },
                            { name: 'Other Services', category: 'Miscellaneous', amount: 49000, percentage: 2.0 }
                        ]
                    }
                },
                accommodation: {
                    month: {
                        stats: { totalRevenue: 1543500, totalBookings: 80, productsSold: 0, avgRevenue: 19294 },
                        revenueTrend: { labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'], values: [346500, 378000, 409500, 409500] },
                        categoryBar: { labels: ['Accommodation'], values: [100] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 1102500, percentage: 71.4 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 441000, percentage: 28.6 }
                        ]
                    },
                    quarter: {
                        stats: { totalRevenue: 370440, totalBookings: 19, productsSold: 0, avgRevenue: 19497 },
                        revenueTrend: { labels: ['Month 1', 'Month 2', 'Month 3'], values: [108000, 118800, 143640] },
                        categoryBar: { labels: ['Accommodation'], values: [100] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 264600, percentage: 71.4 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 105840, percentage: 28.6 }
                        ]
                    },
                    year: {
                        stats: { totalRevenue: 1543500, totalBookings: 80, productsSold: 0, avgRevenue: 19294 },
                        revenueTrend: { labels: ['Q1', 'Q2', 'Q3', 'Q4'], values: [370440, 453600, 453600, 265860] },
                        categoryBar: { labels: ['Accommodation'], values: [100] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 1102500, percentage: 71.4 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 441000, percentage: 28.6 }
                        ]
                    },
                    all: {
                        stats: { totalRevenue: 1543500, totalBookings: 80, productsSold: 0, avgRevenue: 19294 },
                        revenueTrend: { labels: revenueData.labels, values: revenueData.datasets[0].data.map(v => v * 0.63) },
                        categoryBar: { labels: ['Accommodation'], values: [100] },
                        products: [
                            { name: 'Il Ngwesi Ecolodge', category: 'Accommodation', amount: 1102500, percentage: 71.4 },
                            { name: 'Community Homestays', category: 'Accommodation', amount: 441000, percentage: 28.6 }
                        ]
                    }
                },
                marketplace: {
                    month: {
                        stats: { totalRevenue: 441000, totalBookings: 0, productsSold: 147, avgRevenue: 0 },
                        revenueTrend: { labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'], values: [110250, 132300, 132300, 66150] },
                        categoryBar: { labels: ['Marketplace'], values: [100] },
                        products: [
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 294000, percentage: 66.7 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 147000, percentage: 33.3 }
                        ]
                    },
                    quarter: {
                        stats: { totalRevenue: 105840, totalBookings: 0, productsSold: 35, avgRevenue: 0 },
                        revenueTrend: { labels: ['Month 1', 'Month 2', 'Month 3'], values: [35280, 35280, 35280] },
                        categoryBar: { labels: ['Marketplace'], values: [100] },
                        products: [
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 70560, percentage: 66.7 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 35280, percentage: 33.3 }
                        ]
                    },
                    year: {
                        stats: { totalRevenue: 441000, totalBookings: 0, productsSold: 147, avgRevenue: 0 },
                        revenueTrend: { labels: ['Q1', 'Q2', 'Q3', 'Q4'], values: [105840, 132300, 132300, 70560] },
                        categoryBar: { labels: ['Marketplace'], values: [100] },
                        products: [
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 294000, percentage: 66.7 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 147000, percentage: 33.3 }
                        ]
                    },
                    all: {
                        stats: { totalRevenue: 441000, totalBookings: 0, productsSold: 147, avgRevenue: 0 },
                        revenueTrend: { labels: revenueData.labels, values: revenueData.datasets[0].data.map(v => v * 0.18) },
                        categoryBar: { labels: ['Marketplace'], values: [100] },
                        products: [
                            { name: 'Beaded Jewelry', category: 'Marketplace', amount: 294000, percentage: 66.7 },
                            { name: 'Traditional Bags', category: 'Marketplace', amount: 147000, percentage: 33.3 }
                        ]
                    }
                },
                tourism: {
                    month: {
                        stats: { totalRevenue: 367500, totalBookings: 47, productsSold: 0, avgRevenue: 7829 },
                        revenueTrend: { labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'], values: [91900, 91900, 91900, 91800] },
                        categoryBar: { labels: ['Tourism'], values: [100] },
                        products: [
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 196000, percentage: 53.3 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 98000, percentage: 26.7 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 73500, percentage: 20.0 }
                        ]
                    },
                    quarter: {
                        stats: { totalRevenue: 88200, totalBookings: 11, productsSold: 0, avgRevenue: 8018 },
                        revenueTrend: { labels: ['Month 1', 'Month 2', 'Month 3'], values: [29400, 29400, 29400] },
                        categoryBar: { labels: ['Tourism'], values: [100] },
                        products: [
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 47040, percentage: 53.3 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 23520, percentage: 26.7 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 17640, percentage: 20.0 }
                        ]
                    },
                    year: {
                        stats: { totalRevenue: 367500, totalBookings: 47, productsSold: 0, avgRevenue: 7829 },
                        revenueTrend: { labels: ['Q1', 'Q2', 'Q3', 'Q4'], values: [88200, 110250, 110250, 58800] },
                        categoryBar: { labels: ['Tourism'], values: [100] },
                        products: [
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 196000, percentage: 53.3 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 98000, percentage: 26.7 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 73500, percentage: 20.0 }
                        ]
                    },
                    all: {
                        stats: { totalRevenue: 367500, totalBookings: 47, productsSold: 0, avgRevenue: 7829 },
                        revenueTrend: { labels: revenueData.labels, values: revenueData.datasets[0].data.map(v => v * 0.15) },
                        categoryBar: { labels: ['Tourism'], values: [100] },
                        products: [
                            { name: 'Guided Wildlife Walks', category: 'Tourism', amount: 196000, percentage: 53.3 },
                            { name: 'Cultural Evenings', category: 'Tourism', amount: 98000, percentage: 26.7 },
                            { name: 'Bush Breakfasts', category: 'Tourism', amount: 73500, percentage: 20.0 }
                        ]
                    }
                },
                cultural: {
                    month: {
                        stats: { totalRevenue: 49000, totalBookings: 0, productsSold: 0, avgRevenue: 0 },
                        revenueTrend: { labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'], values: [12250, 12250, 12250, 12250] },
                        categoryBar: { labels: ['Cultural'], values: [100] },
                        products: [
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 49000, percentage: 100.0 }
                        ]
                    },
                    quarter: {
                        stats: { totalRevenue: 11760, totalBookings: 0, productsSold: 0, avgRevenue: 0 },
                        revenueTrend: { labels: ['Month 1', 'Month 2', 'Month 3'], values: [3920, 3920, 3920] },
                        categoryBar: { labels: ['Cultural'], values: [100] },
                        products: [
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 11760, percentage: 100.0 }
                        ]
                    },
                    year: {
                        stats: { totalRevenue: 49000, totalBookings: 0, productsSold: 0, avgRevenue: 0 },
                        revenueTrend: { labels: ['Q1', 'Q2', 'Q3', 'Q4'], values: [11760, 14700, 14700, 7840] },
                        categoryBar: { labels: ['Cultural'], values: [100] },
                        products: [
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 49000, percentage: 100.0 }
                        ]
                    },
                    all: {
                        stats: { totalRevenue: 49000, totalBookings: 0, productsSold: 0, avgRevenue: 0 },
                        revenueTrend: { labels: revenueData.labels, values: revenueData.datasets[0].data.map(v => v * 0.02) },
                        categoryBar: { labels: ['Cultural'], values: [100] },
                        products: [
                            { name: 'Manyatta Experiences', category: 'Cultural', amount: 49000, percentage: 100.0 }
                        ]
                    }
                }
            };

            // Function to update all dashboard values
            function updateDashboard(categoryFilter, periodFilter) {
                const category = categoryFilter.toLowerCase();
                const period = periodFilter.toLowerCase();
                
                const data = dashboardData[category] && dashboardData[category][period] 
                    ? dashboardData[category][period] 
                    : dashboardData['all'][period];

                // Update stats
                if (data.stats) {
                    const statBoxes = document.querySelectorAll('.stat-box');
                    if (statBoxes.length >= 4) {
                        const revenueValue = statBoxes[0].querySelector('.stat-box-value');
                        if (revenueValue) revenueValue.textContent = 'KES ' + data.stats.totalRevenue.toLocaleString();
                        
                        const bookingsValue = statBoxes[1].querySelector('.stat-box-value');
                        if (bookingsValue) bookingsValue.textContent = data.stats.totalBookings.toLocaleString();
                        
                        const productsValue = statBoxes[2].querySelector('.stat-box-value');
                        if (productsValue) productsValue.textContent = data.stats.productsSold.toLocaleString();
                        
                        const avgValue = statBoxes[3].querySelector('.stat-box-value');
                        if (avgValue) avgValue.textContent = data.stats.avgRevenue > 0 ? 'KES ' + data.stats.avgRevenue.toLocaleString() : 'N/A';
                    }
                }

                // Update revenue trend chart
                if (data.revenueTrend && typeof revenueTrendChart !== 'undefined') {
                    revenueTrendChart.data.labels = data.revenueTrend.labels;
                    revenueTrendChart.data.datasets[0].data = data.revenueTrend.values;
                    revenueTrendChart.update('active');
                }

                // Update category pie chart
                if (data.categoryBar && typeof categoryPieChart !== 'undefined') {
                    const swahiliLabels = data.categoryBar.labels.map(label => {
                        if (label === 'Accommodation') return 'Malazi';
                        if (label === 'Marketplace') return 'Soko';
                        if (label === 'Tourism') return 'Utalii';
                        if (label === 'Cultural') return 'Kitamaduni';
                        return label;
                    });
                    categoryPieChart.data.labels = swahiliLabels;
                    categoryPieChart.data.datasets[0].data = data.categoryBar.values;
                    categoryPieChart.update('active');
                }

                // Update category bar chart
                if (data.categoryBar && typeof categoryBarChart !== 'undefined') {
                    const swahiliLabels = data.categoryBar.labels.map(label => {
                        if (label === 'Accommodation') return 'Malazi';
                        if (label === 'Marketplace') return 'Soko';
                        if (label === 'Tourism') return 'Utalii';
                        if (label === 'Cultural') return 'Kitamaduni';
                        return label;
                    });
                    categoryBarChart.data.labels = swahiliLabels;
                    categoryBarChart.data.datasets[0].data = data.categoryBar.values;
                    categoryBarChart.update('active');
                }

                // Update product performance chart
                if (data.products && typeof productPerformanceChart !== 'undefined') {
                    const topProducts = data.products.slice(0, 6);
                    productPerformanceChart.data.labels = topProducts.map(p => p.name.split(' ')[0]);
                    productPerformanceChart.data.datasets[0].data = topProducts.map(p => p.amount);
                    productPerformanceChart.update('active');
                }

                // Update revenue breakdown rows
                if (data.products) {
                    const rows = document.querySelectorAll('.revenue-row');
                    rows.forEach((row, index) => {
                        if (index < data.products.length) {
                            const product = data.products[index];
                            const nameEl = row.querySelector('.revenue-col-name');
                            const amountEl = row.querySelector('.revenue-col-amount');
                            const percentageEl = row.querySelector('.percentage-badge');
                            const barFill = row.querySelector('.revenue-bar-fill');
                            const categoryBadge = row.querySelector('.category-badge');
                            
                            if (nameEl) nameEl.textContent = product.name;
                            if (amountEl) {
                                const amount = product.amount;
                                if (amount >= 1000000) {
                                    amountEl.textContent = 'KES ' + (amount / 1000000).toFixed(1) + 'M';
                                } else if (amount >= 1000) {
                                    amountEl.textContent = 'KES ' + (amount / 1000).toFixed(0) + 'K';
                                } else {
                                    amountEl.textContent = 'KES ' + amount.toLocaleString();
                                }
                            }
                            if (percentageEl) percentageEl.textContent = product.percentage.toFixed(1) + '%';
                            if (barFill) {
                                barFill.style.width = product.percentage + '%';
                                barFill.dataset.percentage = product.percentage;
                            }
                            if (categoryBadge) {
                                let badgeClass = product.category.toLowerCase();
                                if (badgeClass.includes('marketplace')) badgeClass = 'marketplace';
                                else if (badgeClass.includes('accommodation')) badgeClass = 'accommodation';
                                else if (badgeClass.includes('tourism')) badgeClass = 'tourism';
                                else if (badgeClass.includes('cultural')) badgeClass = 'cultural';
                                else if (badgeClass.includes('miscellaneous')) badgeClass = 'miscellaneous';
                                categoryBadge.className = 'category-badge ' + badgeClass;
                            }
                            
                            row.dataset.category = product.category;
                            row.style.display = '';
                            row.classList.remove('hidden');
                        } else {
                            row.style.display = 'none';
                            row.classList.add('hidden');
                        }
                    });
                }
            }

            // Get current active filters
            function getActiveFilters() {
                const activeCategory = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
                const activePeriod = document.querySelector('.time-period-btn.active')?.dataset.period || 'month';
                return { category: activeCategory, period: activePeriod };
            }

            // Time period selector with chart updates
            document.querySelectorAll('.time-period-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelectorAll('.time-period-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const filters = getActiveFilters();
                updateDashboard(filters.category, filters.period);
            });
            });

            // Filter functionality
            document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const filters = getActiveFilters();
                updateDashboard(filters.category, filters.period);
            });
        });

            // Animate revenue bars on load
            window.addEventListener('load', function() {
            document.querySelectorAll('.revenue-bar-fill').forEach((bar, index) => {
                const percentage = bar.dataset.percentage;
                bar.style.width = '0%';
                setTimeout(() => {
                    bar.style.transition = 'width 1s ease';
                    bar.style.width = percentage + '%';
                }, index * 50);
            });
            });

            // Add click functionality to revenue rows
            document.querySelectorAll('.revenue-row').forEach(row => {
            row.addEventListener('click', function() {
                const nameEl = this.querySelector('.revenue-col-name');
                const amountEl = this.querySelector('.revenue-col-amount');
                const percentageEl = this.querySelector('.percentage-badge');
                
                if (nameEl && amountEl && percentageEl) {
                    const name = nameEl.textContent.trim();
                    const amount = amountEl.textContent.trim();
                    const percentage = percentageEl.textContent.trim();
                    
                    // Highlight the row
                    document.querySelectorAll('.revenue-row').forEach(r => {
                        r.style.background = '';
                        r.style.borderColor = '#e5e7eb';
                    });
                    this.style.background = '#fef3e7';
                    this.style.borderColor = 'var(--primary-color)';
                    
                    console.log('Selected:', { name, amount, percentage });
                    // In a real implementation, this could show detailed breakdown or update other charts
                }
            });
        });

            // Logout functionality
            document.getElementById('logoutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('Je, una uhakika unataka kutoka?')) {
                    localStorage.removeItem('communityAuthenticated');
                    localStorage.removeItem('communityLoginTime');
                    window.location.href = 'login.html';
                }
            });
        }); // End of DOMContentLoaded
    </script>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Il Ngwesi Conservancy</h3>
                    <p>People of Wildlife</p>
                    <p>Community-owned and operated tourism</p>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <p>Email: info@ilngwesi.com</p>
                    <p>Phone: +254 (0) 741 770 540</p>
                    <p>Tourism Steward: Available 7AM-7PM</p>
                </div>
                <div class="footer-section">
                    <h4>Location</h4>
                    <p>Il Ngwesi Group Ranch</p>
                    <p>Laikipia County, Kenya</p>
                    <p>Via Lewa Wildlife Conservancy</p>
                </div>
                <div class="footer-section">
                    <h4>System</h4>
                    <p>Powered by Community Tourism Relay</p>
                    <p>Low-tech, community-owned booking system</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Il Ngwesi Conservancy. All rights reserved.</p>
            </div>
        </div>
    </footer>
</body>
</html>
